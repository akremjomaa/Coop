import{x as v,f as _,s as h,g as f,o as b,u as l,a as m,c as g,b as e,w as $,v as x,i as M,y,h as S,j as k,k as C,e as V,t as u,F as E,p as B,q as N}from"./index.4334a7d3.js";import{u as F}from"./conversations.30dee324.js";const T={key:0,class:"column is-12 control columns"},U=["onSubmit"],j=e("button",{class:"button is-info"},"Send",-1),D={__name:"UpdateMessageForm",props:["message"],setup(p){const s=p,c=v("bus"),t=_();h();const n=f({message:"",visible:!1});c.on("set-message",i=>{i.id==s.message.id&&(n.message=i.message,n.visible=!0)}),b(()=>{console.log("ok"),console.log(s)});function a(){api.patch(`channels/${s.message.channel_id}/posts/${s.message.id}?token=${t.data.token}`,{body:n}).then(i=>{console.log(i),n.visible=!1,c.emit(`update-message-${s.message.id}`,n.message)}).catch(i=>console.log(i))}return(i,o)=>l(n).visible?(m(),g("div",T,[e("form",{onSubmit:M(a,["prevent"])},[$(e("input",{class:"input is-focused column is-four-fifths","onUpdate:modelValue":o[0]||(o[0]=d=>l(n).message=d),id:"{{props.id}}",type:"text"},null,512),[[x,l(n).message]]),j],40,U)])):y("",!0)}},O=["data-id"],q={class:"column is-10 is-desktop"},A={class:"subtitle"},L=["src"],R={key:0,class:"subtitle has-text-info"},z={class:"subtitle"},G={__name:"Message",props:["conversation","message"],setup(p){const s=p,c=v("bus");h();const t=_(),n=F(),a=f({modeEdition:!1,message:""});b(()=>{a.message=s.message.message,console.log(s.message),c.on(`update-message-${s.message.id}`,d=>{a.message=d,a.modeEdition=!1})});function i(){a.modeEdition=!0,c.emit("set-message",{id:s.message.id,message:a.message})}function o(){api.delete(`channels/${s.message.channel_id}/posts/${s.message.id}?token=${t.data.token}`).then(d=>{n.state.messages=d,window.location.reload()})}return(d,r)=>{const w=S("router-link");return m(),g("div",{class:"box column is-9 is-offset-2-desktop is-flex is-desktop","data-id":s.conversation.channel_id},[e("div",q,[e("h2",A,[k(w,{to:`/oneMember/${s.message.member_id}`},{default:C(()=>[e("img",{src:`https://gravatar.com/avatar/${s.message.member_id}?s=200&d=robohash&r=x`,alt:""},null,8,L),V(u(s.message.member_id),1)]),_:1},8,["to"])]),k(D,{message:s.message},null,8,["message"]),l(a).modeEdition?y("",!0):(m(),g("h1",R,u(l(a).message),1)),e("h2",z,"Created at "+u(s.message.created_at),1)]),e("button",{onClick:o,type:"button",class:"button is-link is-outlined"},"\u{1F5D1}\uFE0F"),e("button",{onClick:i,type:"button",class:"button is-link is-outlined"},"\u270D\u{1F3FD}")],8,O)}}},H=e("h1",{class:"title has-text-link"},"One conversation",-1),I={class:"title has-text-dark"},J={class:"title has-text-dark"},K={class:"column is-7 control columns"},P=["onSubmit"],Q=e("label",{class:"label"},"Add new message",-1),W=e("button",{class:"button is-info"},"Send",-1),Z={__name:"OneConversationView",setup(p){const s=_(),c=h();let t=f({channel:{},messages:[],postMessage:{}});b(()=>{console.log("one conversation"),n(),a()});function n(){api.get(`channels/${c.params.id}?token=${s.data.token}`).then(o=>{t.channel=o,console.log(t.channel)})}function a(){api.get(`channels/${c.params.id}/posts?token=${s.data.token}`).then(o=>{t.messages=o,console.log(t.messages)})}function i(){api.post(`channels/${c.params.id}/posts?token=${s.data.token}`,{body:t.postMessage}).then(o=>{o.message?(alert(o.message),window.location.reload(),t.postMessage.message=""):console.log(o)}).catch(o=>console.log(o))}return(o,d)=>(m(),g("main",null,[H,e("div",null,[e("h2",I,u(l(t).channel.topic),1),e("h2",J,u(l(t).channel.label),1)]),e("div",null,[(m(!0),g(E,null,B(l(t).messages,r=>(m(),N(G,{key:r.id,message:r,conversation:l(t).channel},null,8,["message","conversation"]))),128)),e("div",K,[e("form",{onSubmit:M(i,["prevent"])},[Q,$(e("input",{class:"input is-focused column is-four-fifths","onUpdate:modelValue":d[0]||(d[0]=r=>l(t).postMessage.message=r),type:"text"},null,512),[[x,l(t).postMessage.message]]),W],40,P)])])]))}};export{Z as default};
